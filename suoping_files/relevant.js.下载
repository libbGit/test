/*获取渠道号*/
function GetQueryString(name) {
    var reg = new RegExp('(^|&?)' + name + '=([^&?]*)(&?|$)', 'i');
    var r = window.location.search.substr(1).match(reg);
    if (r != null) {
        return unescape(r[2]);
    }
    return null;
}
/*获取渠道号*/
var channelno = GetQueryString("channelCode");
var adUrl = GetQueryString("ad");
//var artic=parseInt(window.location.href.split("_")[1]);
if(GetQueryString("id") == null) {

    if(testUrl.indexOf("article_") != -1) {
        artic = testUrl.substring(testUrl.indexOf("article_") + 8, testUrl.indexOf(".html"));
    }
} else {
    artic = GetQueryString("id"); //获取参数id
}
console.log(artic);
console.log(channelno);
var listHeight=0;
if(channelno=='huawei_test'){
    var str='<div id="relevant">\n' +
        '\t\t\t<div id="relevant_tit">相关推荐</div>\n' +
        '\t\t\t<ul id="relevant_list"></ul>\n' +
        '\t\t</div>';
}else {
    var str='<div id="relevant">\n' +
        '\t\t\t<div id="relevant_tit">精彩推荐</div>\n' +
        '\t\t\t<div id="relevant_side"></div>\n' +
        '\t\t\t<ul id="relevant_list"></ul>\n' +
        '\t\t</div>';
}

if(channelno=='meizu_china'){
    $('#meizgg').after(str);
    $("#relevant").css('position','relative');
    $("#relevant").css('margin-top','0.67rem');
}else {
    $('body').append(str);
}


/*动态创建li*/
function addLi(char, pic,data) {
    var li_1 = document.createElement("li");
    var li_a = document.createElement("a");
    li_1.setAttribute("class", "data");
    li_1.setAttribute("data-h5",data);
    li_a.setAttribute("href",data);
    li_1.appendChild(li_a);
    li_a.style.color = '#333';
    addSpan(li_a, char);
    addA(li_a, pic,data);
    document.getElementById("relevant_list").appendChild(li_1);
}
/*在li中动态创建span标签*/
function addSpan(li, text) {
    var lab_sp = document.createElement("span");
    lab_sp.setAttribute("class", "char");
    lab_sp.innerHTML = text;
    li.appendChild(lab_sp);
}
/*在li中动态创建a标签*/
function addA(li, pic_i,data) {
    var lab_a = document.createElement("a");
    lab_a.setAttribute("id", "img_a");
    lab_a.setAttribute("href",data);
    osrc(lab_a,pic_i);
    li.appendChild(lab_a);
}
/*创建img标签存放于a标签中*/
function osrc(a, im) {
    var oImg=document.createElement("img");
    oImg.src=im;
    a.appendChild(oImg);
}
var textc=$.trim($("#tex_c").text());
var categoryname=textc;
if(textc!='' && textc!=null && textc!=undefined){
    if(textc.indexOf(';')){
        categoryname=textc.split(';')[0];
    }else {
        categoryname='其他';
    }
    console.log(categoryname);
}else if(textc==''){
    categoryname='其他';
}

$.ajax({
    /*url:"http://192.168.50.111:8083/articles/recommend?articleid=11111107&channelCode=htc",*/
    url: "https://adpush.bizhiquan.com/articles/recommend?articleid="+artic+"&channelCode="+channelno+"&categoryname="+categoryname+"",
    data: {},
    type: "post",
    dataType: "json",
    success: function(das) {
        /*循环遍历数据,动态添加到li中*/
        var data;
        if(das.result!=''){
            data= JSON.parse(das.result);
        }
        console.log(data);
        if(data!=undefined && data.length!='0'){
            for(var i = 0; i < data.length; i++) {
                if(data[i].cover!=""){
                    listHeight=listHeight+1.8;
                    addLi(data[i].title, data[i].cover,data[i].h5);
                }
            }
            if(channelno=='meizu_china'){
                $("#relevant_list").css('height',listHeight+"rem");
                $("#relevant_list li").each(function (index,item) {
                    var lisLength=$("#relevant_list li").length-1;
                    if(index==lisLength){
                        $(item).css("border-bottom","1px")
                    }
                });
                $("#handL").remove();
                var stc='<div class="handI" id="handL">\n' +
                    '\t\t\t<div class="h_img" id="h_imgs"><img src="https://unock.bizhiquan.com/common/img/logo_header.png" /></div>\n' +
                    '\t\t</div>';
                $('#relevant').append(stc);
                $("#handL").css('position','absolute');
                $("#handL").css('bottom','-1.4rem');
            }else if(channelno=='huawei_test'){
                $(".data #img_a img").css('border-radius','0');
                $(".data").css({"margin-top":"-0.14rem","height":"1.7rem","border-bottom":"1px solid rgb(0, 0, 0,20%)"})
                $("#relevant_tit").css({'margin-bottom':'-0.05rem','font-weight':'700',"font-size":"0.32rem"});
                $("#relevant .char").css({"font-family":'regular','color':'#7f7f7f'})
            }else if(channelno=='samsung'){
                $('#relevant .char').css('width','50%');
            }
            /*动态创建已显示全部的div,存放于box底部*/
            var oBot = document.createElement("div");
            oBot.setAttribute("id", "bas");
            oBot.innerHTML = "已显示全部内容";
            $("#oppoBanner").remove();

            //box.parentNode.insertBefore(oBot, box.nextSibling)
            /*  for(var i = 0; i < data; i++) {
                  var item = data[i];
                  if(item.cover!=""){
                      addLi(item.title, item.cover);
                  }
              }*/
            /*  $(function() {
                  /!*上滑刷新*!/
                  $(window).scroll(function() { /!*监听滚动事件*!/
                      var scrollH = document.documentElement.scrollHeight;
                      var clientH = document.documentElement.clientHeight;
                      if(scrollH == (document.documentElement.scrollTop | document.body.scrollTop) + clientH) {
                          $.ajax({
                              url: "https://adpush.bizhiquan.com/articles/recommend?articleid="+artic+"&channelCode="+channelno+"&categoryname="+categoryname+"",
                              data:{},
                              type:'get',
                              dataType:'json',
                              success:function (das) {
                                  var data= JSON.parse(das.result);
                                  var oUl = document.getElementById("relevant_list");
                                  oUl.innerHTML = "";
                                  listHeight=0;
                                  $.each(data,function (index, item) {
                                      if(item.cover!=""){
                                          addLi(item.title, item.cover,item.h5);
                                          listHeight=listHeight+120;
                                      }
                                  });
                                  if(channelno=='meizu_china'){
                                      $("#relevant_list").css('height',listHeight+"px");
                                  }
                              }
                          });
                      }
                  });

              });*/
        }else {
            $("#relevant").remove();
        }
    }
});
